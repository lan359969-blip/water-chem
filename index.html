import React, { useState, useEffect } from â€˜reactâ€™;
import { Calculator, Beaker, Droplet, ClipboardCopy, Settings, FileText } from â€˜lucide-reactâ€™;

// ==================== é…ç½®ç®¡ç† ====================
const CONFIG = {
version: â€˜3.0.0â€™,
storageKey: â€˜water_treatment_data_v3â€™,
defaultConcentrations: {
phase1: { coagulant: 10, flocculant: 5 },
phase2: { coagulant: 10, flocculant: 5 },
chlorine1: 0,
chlorine2: 0
}
};

// ==================== å·¥å…·å‡½æ•° ====================
const copyToClipboard = async (text) => {
try {
await navigator.clipboard.writeText(text);
return true;
} catch (err) {
const textarea = document.createElement(â€˜textareaâ€™);
textarea.value = text;
textarea.style.position = â€˜fixedâ€™;
textarea.style.opacity = â€˜0â€™;
document.body.appendChild(textarea);
textarea.select();
try {
document.execCommand(â€˜copyâ€™);
document.body.removeChild(textarea);
return true;
} catch (e) {
document.body.removeChild(textarea);
return false;
}
}
};

// ==================== UIç»„ä»¶ ====================
const Toast = ({ message, onClose }) => {
useEffect(() => {
const timer = setTimeout(onClose, 2000);
return () => clearTimeout(timer);
}, [onClose]);

return (
<div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50">
<div className="bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg">
{message}
</div>
</div>
);
};

const Card = ({ title, icon: Icon, children }) => (

  <div className="bg-white rounded-xl shadow-md overflow-hidden mb-4">
    <div className="bg-gradient-to-r from-emerald-500 to-teal-400 text-white px-4 py-3 flex items-center gap-2">
      {Icon && <Icon size={20} />}
      <h2 className="text-lg font-semibold">{title}</h2>
    </div>
    <div className="p-4">{children}</div>
  </div>
);

const InputField = ({ label, value, onChange, step = â€˜1â€™, disabled = false }) => (

  <div className="mb-3">
    <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
    <input
      type="number"
      value={value}
      onChange={onChange}
      step={step}
      disabled={disabled}
      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none disabled:bg-gray-100"
    />
  </div>
);

// ==================== ä¸»åº”ç”¨ ====================
export default function WaterTreatmentSystem() {
const [toast, setToast] = useState(null);
const [activeTab, setActiveTab] = useState(â€˜dosingâ€™);

// è¿›æ°´é‡
const [waterFlows, setWaterFlows] = useState({
system12: 0,
system34: 0,
system56: 0,
w51: 0,
w52: 0,
w61: 0,
w62: 0
});

// æµ“åº¦
const [concentrations, setConcentrations] = useState(CONFIG.defaultConcentrations);

// åŠ è¯å·®å€¼
const [phase1CoagDiff, setPhase1CoagDiff] = useState({ a: 0, b: 0, c: 0, d: 0 });
const [phase1FlocDiff, setPhase1FlocDiff] = useState({ a: 0, b: 0, c: 0, d: 0 });
const [phase2CoagDiff, setPhase2CoagDiff] = useState({ s51: 0, s52: 0, s61: 0, s62: 0 });
const [phase2FlocDiff, setPhase2FlocDiff] = useState({ s51: 0, s52: 0, s61: 0, s62: 0 });

// åŠ æ°¯å·®å€¼
const [preClDiff, setPreClDiff] = useState({ ab: 0, cd: 0, e: 0, f: 0 });
const [mainClDiff, setMainClDiff] = useState({ ab: 0, cd: 0, e: 0, f: 0 });
const [suppClDiff, setSuppClDiff] = useState({ a: 0, b: 0, c: 0, d: 0 });
const [includeSupp, setIncludeSupp] = useState(false);

const [wechatInput, setWechatInput] = useState(â€™â€™);
const [dosingResults, setDosingResults] = useState(null);
const [chlorineResults, setChlorineResults] = useState(null);

// æ°´é‡åˆ†é…æ¯”ä¾‹
const [waterRatios, setWaterRatios] = useState({
r51: 0.25,
r52: 0.25,
r61: 0.25,
r62: 0.25
});

// 56ç³»æ°´é‡è‡ªåŠ¨åˆ†é…
useEffect(() => {
const total = waterFlows.system56;
if (total > 0) {
setWaterFlows(prev => ({
â€¦prev,
w51: Math.round(total * waterRatios.r51),
w52: Math.round(total * waterRatios.r52),
w61: Math.round(total * waterRatios.r61),
w62: Math.round(total * waterRatios.r62)
}));
}
}, [waterFlows.system56, waterRatios]);

// å¾®ä¿¡æ•°æ®è§£æ
const handleWeChatParse = () => {
const p12 = /(?<=ã€1-2ç³»:\s*)\d+(?=ã€‘)/.exec(wechatInput);
const p34 = /(?<=ã€3-4ç³»:\s*)\d+(?=ã€‘)/.exec(wechatInput);
const p56 = /(?<=ã€5-6ç³»:\s*)\d+(?=ã€‘)/.exec(wechatInput);

```
if (p12 && p34 && p56) {
  setWaterFlows(prev => ({
    ...prev,
    system12: parseInt(p12[0]),
    system34: parseInt(p34[0]),
    system56: parseInt(p56[0])
  }));
  setToast('âœ… æ•°æ®è¯»å–æˆåŠŸ');
  setWechatInput('');
} else {
  setToast('âŒ æ•°æ®æ ¼å¼é”™è¯¯');
}
```

};

// åŠ è¯è®¡ç®—
const handleDosingCalc = () => {
const { system12: ab, system34: cd, w51, w52, w61, w62 } = waterFlows;
const { phase1, phase2 } = concentrations;

```
const p1CoagAB = ((phase1CoagDiff.a + phase1CoagDiff.b) * phase1.coagulant * 0.2).toFixed(2);
const p1CoagCD = ((phase1CoagDiff.c + phase1CoagDiff.d) * phase1.coagulant * 0.2).toFixed(2);
const p1FlocAB = ((phase1FlocDiff.a + phase1FlocDiff.b) * phase1.flocculant * 0.2).toFixed(2);
const p1FlocCD = ((phase1FlocDiff.c + phase1FlocDiff.d) * phase1.flocculant * 0.2).toFixed(2);

const p2CoagS51 = w51 > 0 ? ((phase2CoagDiff.s51 * phase2.coagulant * 100) / w51).toFixed(2) : '0.00';
const p2CoagS52 = w52 > 0 ? ((phase2CoagDiff.s52 * phase2.coagulant * 100) / w52).toFixed(2) : '0.00';
const p2CoagS61 = w61 > 0 ? ((phase2CoagDiff.s61 * phase2.coagulant * 100) / w61).toFixed(2) : '0.00';
const p2CoagS62 = w62 > 0 ? ((phase2CoagDiff.s62 * phase2.coagulant * 100) / w62).toFixed(2) : '0.00';

const p2FlocS51 = w51 > 0 ? ((phase2FlocDiff.s51 * phase2.flocculant * 100) / w51).toFixed(2) : '0.00';
const p2FlocS52 = w52 > 0 ? ((phase2FlocDiff.s52 * phase2.flocculant * 100) / w52).toFixed(2) : '0.00';
const p2FlocS61 = w61 > 0 ? ((phase2FlocDiff.s61 * phase2.flocculant * 100) / w61).toFixed(2) : '0.00';
const p2FlocS62 = w62 > 0 ? ((phase2FlocDiff.s62 * phase2.flocculant * 100) / w62).toFixed(2) : '0.00';

setDosingResults({
  p1: { coagAB: p1CoagAB, coagCD: p1CoagCD, flocAB: p1FlocAB, flocCD: p1FlocCD },
  p2: {
    coag: { s51: p2CoagS51, s52: p2CoagS52, s61: p2CoagS61, s62: p2CoagS62 },
    floc: { s51: p2FlocS51, s52: p2FlocS52, s61: p2FlocS61, s62: p2FlocS62 }
  }
});
setToast('âœ… è®¡ç®—å®Œæˆ');
```

};

// åŠ æ°¯è®¡ç®—
const handleChlorineCalc = () => {
const { system12: ab, system34: cd, w51, w52, w61, w62 } = waterFlows;
const e = w51 + w52;
const f = w61 + w62;
const { chlorine1: c1, chlorine2: c2 } = concentrations;

```
const preAB = ab > 0 ? ((preClDiff.ab * c1 * 0.1 * 1000) / ab).toFixed(2) : '0.00';
const preCD = cd > 0 ? ((preClDiff.cd * c1 * 0.1 * 1000) / cd).toFixed(2) : '0.00';
const preE = e > 0 ? ((preClDiff.e * c2 * 100) / e).toFixed(2) : '0.00';
const preF = f > 0 ? ((preClDiff.f * c2 * 100) / f).toFixed(2) : '0.00';

const mainAB = ab > 0 ? ((mainClDiff.ab * c1 * 0.1 * 1000) / ab).toFixed(2) : '0.00';
const mainCD = cd > 0 ? ((mainClDiff.cd * c1 * 0.1 * 1000) / cd).toFixed(2) : '0.00';
const mainE = e > 0 ? ((mainClDiff.e * c2 * 100) / e).toFixed(2) : '0.00';
const mainF = f > 0 ? ((mainClDiff.f * c2 * 100) / f).toFixed(2) : '0.00';

const results = {
  pre: { ab: preAB, cd: preCD, e: preE, f: preF },
  main: { ab: mainAB, cd: mainCD, e: mainE, f: mainF }
};

if (includeSupp) {
  const suppA = ab > 0 ? ((suppClDiff.a * c1 * 0.1 * 1000) / ab).toFixed(2) : '0.00';
  const suppB = ab > 0 ? ((suppClDiff.b * c1 * 0.1 * 1000) / ab).toFixed(2) : '0.00';
  const suppC = cd > 0 ? ((suppClDiff.c * c1 * 0.1 * 1000) / cd).toFixed(2) : '0.00';
  const suppD = cd > 0 ? ((suppClDiff.d * c1 * 0.1 * 1000) / cd).toFixed(2) : '0.00';
  results.supp = { a: suppA, b: suppB, c: suppC, d: suppD };
}

setChlorineResults(results);
setToast('âœ… è®¡ç®—å®Œæˆ');
```

};

// å¤åˆ¶ç»“æœ
const handleCopy = async (type) => {
let text = â€˜â€™;
if (type === â€˜dosingâ€™ && dosingResults) {
const { p1, p2 } = dosingResults;
text = `ä¸€æœŸï¼š\næ··å‡ AB:${p1.coagAB} CD:${p1.coagCD}\nåŠ©å‡ AB:${p1.flocAB} CD:${p1.flocCD}\n\näºŒæœŸï¼š\næ··å‡ 5-1:${p2.coag.s51} 5-2:${p2.coag.s52} 6-1:${p2.coag.s61} 6-2:${p2.coag.s62}\nåŠ©å‡ 5-1:${p2.floc.s51} 5-2:${p2.floc.s52} 6-1:${p2.floc.s61} 6-2:${p2.floc.s62}`;
} else if (type === â€˜chlorineâ€™ && chlorineResults) {
const { pre, main, supp } = chlorineResults;
text = `å‰åŠ æ°¯ï¼š\nAB:${pre.ab} CD:${pre.cd} E:${pre.e} F:${pre.f}\n\nä¸»åŠ æ°¯ï¼š\nAB:${main.ab} CD:${main.cd} E:${main.e} F:${main.f}`;
if (supp) {
text += `\n\nè¡¥æ°¯ï¼š\nA:${supp.a} B:${supp.b} C:${supp.c} D:${supp.d}`;
}
}
const success = await copyToClipboard(text);
setToast(success ? â€˜âœ… å·²å¤åˆ¶â€™ : â€˜âŒ å¤åˆ¶å¤±è´¥â€™);
};

return (
<div className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-50 p-4">
<div className="max-w-4xl mx-auto">
{/* å¤´éƒ¨ */}
<div className="bg-white rounded-xl shadow-md p-5 mb-4 text-center">
<h1 className="text-2xl font-bold text-gray-800">ğŸ§ª æ°´å¤„ç†åŠ è¯è®¡ç®—ç³»ç»Ÿ</h1>
<p className="text-sm text-gray-600 mt-1">å·¥ç¨‹çº§ v{CONFIG.version}</p>
</div>

```
    {/* æ ‡ç­¾é¡µ */}
    <div className="flex gap-2 mb-4">
      <button
        onClick={() => setActiveTab('dosing')}
        className={`flex-1 py-3 rounded-lg font-semibold ${
          activeTab === 'dosing'
            ? 'bg-gradient-to-r from-emerald-500 to-teal-400 text-white shadow-lg'
            : 'bg-white text-gray-600'
        }`}
      >
        <Calculator className="inline mr-2" size={18} />
        åŠ è¯è®¡ç®—
      </button>
      <button
        onClick={() => setActiveTab('chlorine')}
        className={`flex-1 py-3 rounded-lg font-semibold ${
          activeTab === 'chlorine'
            ? 'bg-gradient-to-r from-emerald-500 to-teal-400 text-white shadow-lg'
            : 'bg-white text-gray-600'
        }`}
      >
        <Droplet className="inline mr-2" size={18} />
        åŠ æ°¯è®¡ç®—
      </button>
    </div>

    {/* å¾®ä¿¡å¯¼å…¥ */}
    <Card title="å¾®ä¿¡æ•°æ®å¯¼å…¥" icon={FileText}>
      <textarea
        value={wechatInput}
        onChange={(e) => setWechatInput(e.target.value)}
        placeholder="ç²˜è´´å¾®ä¿¡æ•°æ®..."
        className="w-full h-20 px-3 py-2 border rounded-lg resize-none mb-3"
      />
      <div className="flex gap-2">
        <button
          onClick={handleWeChatParse}
          className="flex-1 bg-emerald-500 text-white py-2 rounded-lg"
        >
          è§£ææ•°æ®
        </button>
        <button
          onClick={() => setWechatInput('')}
          className="px-4 bg-gray-500 text-white py-2 rounded-lg"
        >
          æ¸…ç©º
        </button>
      </div>
    </Card>

    {/* è¿›æ°´é‡ */}
    <Card title="è¿›æ°´é‡é…ç½®" icon={Settings}>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
        <InputField
          label="1-2ç³»"
          value={waterFlows.system12}
          onChange={(e) => setWaterFlows(p => ({ ...p, system12: Number(e.target.value) || 0 }))}
        />
        <InputField
          label="3-4ç³»"
          value={waterFlows.system34}
          onChange={(e) => setWaterFlows(p => ({ ...p, system34: Number(e.target.value) || 0 }))}
        />
        <InputField
          label="5-6ç³»"
          value={waterFlows.system56}
          onChange={(e) => setWaterFlows(p => ({ ...p, system56: Number(e.target.value) || 0 }))}
        />
      </div>
      <div className="p-3 bg-blue-50 rounded-lg">
        <p className="text-sm text-blue-800 font-medium mb-2">ğŸ’¡ æ°´é‡åˆ†é…è°ƒèŠ‚</p>
        <div className="grid grid-cols-2 gap-2">
          <InputField
            label="5-1ç³»"
            value={waterFlows.w51}
            onChange={(e) => {
              const v = Number(e.target.value) || 0;
              setWaterFlows(p => ({ ...p, w51: v }));
              const total = v + waterFlows.w52 + waterFlows.w61 + waterFlows.w62;
              if (total > 0) {
                setWaterRatios({
                  r51: v / total,
                  r52: waterFlows.w52 / total,
                  r61: waterFlows.w61 / total,
                  r62: waterFlows.w62 / total
                });
              }
            }}
          />
          <InputField
            label="5-2ç³»"
            value={waterFlows.w52}
            onChange={(e) => {
              const v = Number(e.target.value) || 0;
              setWaterFlows(p => ({ ...p, w52: v }));
              const total = waterFlows.w51 + v + waterFlows.w61 + waterFlows.w62;
              if (total > 0) {
                setWaterRatios({
                  r51: waterFlows.w51 / total,
                  r52: v / total,
                  r61: waterFlows.w61 / total,
                  r62: waterFlows.w62 / total
                });
              }
            }}
          />
          <InputField
            label="6-1ç³»"
            value={waterFlows.w61}
            onChange={(e) => {
              const v = Number(e.target.value) || 0;
              setWaterFlows(p => ({ ...p, w61: v }));
              const total = waterFlows.w51 + waterFlows.w52 + v + waterFlows.w62;
              if (total > 0) {
                setWaterRatios({
                  r51: waterFlows.w51 / total,
                  r52: waterFlows.w52 / total,
                  r61: v / total,
                  r62: waterFlows.w62 / total
                });
              }
            }}
          />
          <InputField
            label="6-2ç³»"
            value={waterFlows.w62}
            onChange={(e) => {
              const v = Number(e.target.value) || 0;
              setWaterFlows(p => ({ ...p, w62: v }));
              const total = waterFlows.w51 + waterFlows.w52 + waterFlows.w61 + v;
              if (total > 0) {
                setWaterRatios({
                  r51: waterFlows.w51 / total,
                  r52: waterFlows.w52 / total,
                  r61: waterFlows.w61 / total,
                  r62: v / total
                });
              }
            }}
          />
        </div>
      </div>
    </Card>

    {/* åŠ è¯ç•Œé¢ */}
    {activeTab === 'dosing' && (
      <>
        <Card title="æµ“åº¦é…ç½®" icon={Beaker}>
          <div className="grid grid-cols-2 gap-3">
            <InputField
              label="ä¸€æœŸæ··å‡å‰‚(%)"
              value={concentrations.phase1.coagulant}
              onChange={(e) => setConcentrations(p => ({
                ...p,
                phase1: { ...p.phase1, coagulant: Number(e.target.value) || 0 }
              }))}
              step="0.1"
            />
            <InputField
              label="ä¸€æœŸåŠ©å‡å‰‚(%)"
              value={concentrations.phase1.flocculant}
              onChange={(e) => setConcentrations(p => ({
                ...p,
                phase1: { ...p.phase1, flocculant: Number(e.target.value) || 0 }
              }))}
              step="0.1"
            />
            <InputField
              label="äºŒæœŸæ··å‡å‰‚(%)"
              value={concentrations.phase2.coagulant}
              onChange={(e) => setConcentrations(p => ({
                ...p,
                phase2: { ...p.phase2, coagulant: Number(e.target.value) || 0 }
              }))}
              step="0.1"
            />
            <InputField
              label="äºŒæœŸåŠ©å‡å‰‚(%)"
              value={concentrations.phase2.flocculant}
              onChange={(e) => setConcentrations(p => ({
                ...p,
                phase2: { ...p.phase2, flocculant: Number(e.target.value) || 0 }
              }))}
              step="0.1"
            />
          </div>
        </Card>

        <Card title="ä¸€æœŸå·®å€¼" icon={Calculator}>
          <h3 className="font-semibold mb-2">æ··å‡å‰‚</h3>
          <div className="grid grid-cols-2 gap-2 mb-4">
            {['a', 'b', 'c', 'd'].map(s => (
              <InputField
                key={s}
                label={`${s.toUpperCase()}ç³»`}
                value={phase1CoagDiff[s]}
                onChange={(e) => setPhase1CoagDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
          <h3 className="font-semibold mb-2">åŠ©å‡å‰‚</h3>
          <div className="grid grid-cols-2 gap-2">
            {['a', 'b', 'c', 'd'].map(s => (
              <InputField
                key={s}
                label={`${s.toUpperCase()}ç³»`}
                value={phase1FlocDiff[s]}
                onChange={(e) => setPhase1FlocDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
        </Card>

        <Card title="äºŒæœŸå·®å€¼" icon={Calculator}>
          <h3 className="font-semibold mb-2">æ··å‡å‰‚</h3>
          <div className="grid grid-cols-2 gap-2 mb-4">
            {['s51', 's52', 's61', 's62'].map(s => (
              <InputField
                key={s}
                label={s.replace('s5', '5-').replace('s6', '6-')}
                value={phase2CoagDiff[s]}
                onChange={(e) => setPhase2CoagDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
          <h3 className="font-semibold mb-2">åŠ©å‡å‰‚</h3>
          <div className="grid grid-cols-2 gap-2">
            {['s51', 's52', 's61', 's62'].map(s => (
              <InputField
                key={s}
                label={s.replace('s5', '5-').replace('s6', '6-')}
                value={phase2FlocDiff[s]}
                onChange={(e) => setPhase2FlocDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
        </Card>

        <button
          onClick={handleDosingCalc}
          className="w-full bg-gradient-to-r from-emerald-500 to-teal-400 text-white py-4 rounded-xl font-semibold mb-4"
        >
          è®¡ç®—åŠ è¯é‡
        </button>

        {dosingResults && (
          <Card title="è®¡ç®—ç»“æœ" icon={FileText}>
            <div className="bg-gray-50 p-4 rounded-lg mb-3 font-mono text-sm">
              <p className="font-bold mb-1">ä¸€æœŸï¼š</p>
              <p>æ··å‡ AB:{dosingResults.p1.coagAB} CD:{dosingResults.p1.coagCD}</p>
              <p>åŠ©å‡ AB:{dosingResults.p1.flocAB} CD:{dosingResults.p1.flocCD}</p>
              <p className="font-bold mt-2 mb-1">äºŒæœŸï¼š</p>
              <p>æ··å‡ 5-1:{dosingResults.p2.coag.s51} 5-2:{dosingResults.p2.coag.s52}</p>
              <p className="ml-12">6-1:{dosingResults.p2.coag.s61} 6-2:{dosingResults.p2.coag.s62}</p>
              <p>åŠ©å‡ 5-1:{dosingResults.p2.floc.s51} 5-2:{dosingResults.p2.floc.s52}</p>
              <p className="ml-12">6-1:{dosingResults.p2.floc.s61} 6-2:{dosingResults.p2.floc.s62}</p>
            </div>
            <button
              onClick={() => handleCopy('dosing')}
              className="w-full bg-emerald-500 text-white py-3 rounded-lg flex items-center justify-center gap-2"
            >
              <ClipboardCopy size={18} />
              å¤åˆ¶ç»“æœ
            </button>
          </Card>
        )}
      </>
    )}

    {/* åŠ æ°¯ç•Œé¢ */}
    {activeTab === 'chlorine' && (
      <>
        <Card title="æœ‰æ•ˆæ°¯æµ“åº¦" icon={Beaker}>
          <div className="grid grid-cols-2 gap-3">
            <InputField
              label="ä¸€æœŸ(%)"
              value={concentrations.chlorine1}
              onChange={(e) => setConcentrations(p => ({ ...p, chlorine1: Number(e.target.value) || 0 }))}
              step="0.1"
            />
            <InputField
              label="äºŒæœŸ(%)"
              value={concentrations.chlorine2}
              onChange={(e) => setConcentrations(p => ({ ...p, chlorine2: Number(e.target.value) || 0 }))}
              step="0.1"
            />
          </div>
        </Card>

        <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4 rounded">
          <label className="flex items-center gap-2">
            <input
              type="checkbox"
              checked={includeSupp}
              onChange={(e) => setIncludeSupp(e.target.checked)}
              className="w-5 h-5"
            />
            <span className="text-yellow-800 font-medium">å¯ç”¨è¡¥æ°¯è®¡ç®—</span>
          </label>
        </div>

        <Card title="å‰åŠ æ°¯" icon={Calculator}>
          <div className="grid grid-cols-2 gap-2">
            {['ab', 'cd', 'e', 'f'].map(s => (
              <InputField
                key={s}
                label={s.toUpperCase()}
                value={preClDiff[s]}
                onChange={(e) => setPreClDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
        </Card>

        <Card title="ä¸»åŠ æ°¯" icon={Calculator}>
          <div className="grid grid-cols-2 gap-2">
            {['ab', 'cd', 'e', 'f'].map(s => (
              <InputField
                key={s}
                label={s.toUpperCase()}
                value={mainClDiff[s]}
                onChange={(e) => setMainClDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
              />
            ))}
          </div>
        </Card>

        {includeSupp && (
          <Card title="è¡¥æ°¯" icon={Calculator}>
            <div className="grid grid-cols-2 gap-2">
              {['a', 'b', 'c', 'd'].map(s => (
                <InputField
                  key={s}
                  label={`${s.toUpperCase()}ç³»`}
                  value={suppClDiff[s]}
                  onChange={(e) => setSuppClDiff(p => ({ ...p, [s]: Number(e.target.value) || 0 }))}
                />
              ))}
            </div>
          </Card>
        )}

        <button
          onClick={handleChlorineCalc}
          className="w-full bg-gradient-to-r from-emerald-500 to-teal-400 text-white py-4 rounded-xl font-semibold mb-4"
        >
          è®¡ç®—åŠ æ°¯é‡
        </button>

        {chlorineResults && (
          <Card title="è®¡ç®—ç»“æœ" icon={FileText}>
            <div className="bg-gray-50 p-4 rounded-lg mb-3 font-mono text-sm">
              <p className="font-bold mb-1">å‰åŠ æ°¯ï¼š</p>
              <p>AB:{chlorineResults.pre.ab} CD:{chlorineResults.pre.cd}</p>
              <p>E:{chlorineResults.pre.e} F:{chlorineResults.pre.f}</p>
              <p className="font-bold mt-2 mb-1">ä¸»åŠ æ°¯ï¼š</p>
              <p>AB:{chlorineResults.main.ab} CD:{chlorineResults.main.cd}</p>
              <p>E:{chlorineResults.main.e} F:{chlorineResults.main.f}</p>
              {chlorineResults.supp && (
                <>
                  <p className="font-bold mt-2 mb-1">è¡¥æ°¯ï¼š</p>
                  <p>A:{chlorineResults.supp.a} B:{chlorineResults.supp.b}</p>
                  <p>C:{chlorineResults.supp.c} D:{chlorineResults.supp.d}</p>
                </>
              )}
            </div>
            <button
              onClick={() => handleCopy('chlorine')}
              className="w-full bg-emerald-500 text-white py-3 rounded-lg flex items-center justify-center gap-2"
            >
              <ClipboardCopy size={18} />
              å¤åˆ¶ç»“æœ
            </button>
          </Card>
        )}
      </>
    )}

    {/* é¡µè„š */}
    <div className="text-center text-gray-600 text-sm mt-6 pb-4">
      <p>æ°´å¤„ç†åŠ è¯è®¡ç®—ç³»ç»Ÿ v{CONFIG.version}</p>
      <p className="text-xs mt-1">å·¥ç¨‹çº§æ¶æ„ | æ¨¡å—åŒ–è®¾è®¡</p>
    </div>
  </div>

  {/* Toast */}
  {toast && <Toast message={toast} onClose={() => setToast(null)} />}
</div>
```

);
}